generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  name         String   @db.VarChar(255)
  username     String   @unique @db.VarChar(32)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  type         UserType

  @@map("user")
}

model Year {
  id   Int    @id @default(autoincrement())
  name String @unique @db.Char(9)

  rooms                       Room[]
  studentClasses              StudentClass[]
  subjects                    Subject[]
  studentClassSubjectTeachers StudentClassSubjectTeacher[]
  timetableElements           TimetableElement[]

  @@map("year")
}

model Room {
  id   Int    @id @default(autoincrement())
  name String @db.VarChar(32)

  yearId Int  @map("year_id")
  year   Year @relation(fields: [yearId], references: [id], onDelete: Cascade)

  timetableElements         TimetableElement[] @relation("TimetableElements")
  timetableElementsEvenWeek TimetableElement[] @relation("TimetableElementsEvenWeek")
  timetableElementsGroup2   TimetableElement[] @relation("TimetableElementsGroup2")

  @@map("room")
}

model StudentClass {
  id   Int    @id @default(autoincrement())
  name String @db.VarChar(5)

  yearId Int  @map("year_id")
  year   Year @relation(fields: [yearId], references: [id], onDelete: Cascade)

  studentClassSubjectTeachers StudentClassSubjectTeacher[]
  timetableElements           TimetableElement[]

  @@map("student_class")
}

model Subject {
  id           Int     @id @default(autoincrement())
  name         String  @db.VarChar(255)
  abbreviation String? @db.VarChar(32)

  yearId Int  @map("year_id")
  year   Year @relation(fields: [yearId], references: [id], onDelete: Cascade)

  studentClassSubjectTeachers StudentClassSubjectTeacher[]

  @@map("subject")
}

model Teacher {
  id       Int    @id @default(autoincrement())
  name     String @db.VarChar(255)
  initials String @db.VarChar(4)

  studentClassSubjectTeachers StudentClassSubjectTeacher[]

  @@map("teacher")
}

model StudentClassSubjectTeacher {
  id             Int @id @default(autoincrement())
  classesPerWeek Int @db.TinyInt

  studentClassId Int          @map("student_class_id")
  studentClass   StudentClass @relation(fields: [studentClassId], references: [id], onDelete: Cascade)

  subjectId Int     @map("subject_id")
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  teacherId Int     @map("teacher_id")
  teacher   Teacher @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  yearId Int  @map("year_id")
  year   Year @relation(fields: [yearId], references: [id], onDelete: Cascade)

  timetableElements         TimetableElement[] @relation("TimetableElements")
  timetableElementsEvenWeek TimetableElement[] @relation("TimetableElementsEvenWeek")
  timetableElementsGroup2   TimetableElement[] @relation("TimetableElementsGroup2")

  @@map("student_class_subject_teacher")
}

model TimetableElement {
  id          Int      @id @default(autoincrement())
  term        Int      @db.TinyInt
  day         Day
  period      Int      @db.TinyInt
  startTime   DateTime @map("start_time") @db.Time
  endTime     DateTime @map("end_time") @db.Time
  alternating Boolean
  split       Boolean

  yearId Int  @map("year_id")
  year   Year @relation(fields: [yearId], references: [id], onDelete: Cascade)

  studentClassId Int          @map("student_class_id")
  studentClass   StudentClass @relation(fields: [studentClassId], references: [id], onDelete: Cascade)

  studentClassSubjectTeacherId Int                        @map("subject_teacher_id")
  studentClassSubjectTeacher   StudentClassSubjectTeacher @relation("TimetableElements", fields: [studentClassSubjectTeacherId], references: [id], onDelete: Cascade)

  roomId Int  @map("room_id")
  room   Room @relation("TimetableElements", fields: [roomId], references: [id], onDelete: Cascade)

  evenWeekStudentClassSubjectTeacherId Int?                        @map("even_week_student_class_subject_teacher_id")
  evenWeekStudentClassSubjectTeacher   StudentClassSubjectTeacher? @relation("TimetableElementsEvenWeek", fields: [evenWeekStudentClassSubjectTeacherId], references: [id], onDelete: Cascade)

  evenWeekRoomId Int?  @map("even_week_room_id")
  evenWeekRoom   Room? @relation("TimetableElementsEvenWeek", fields: [evenWeekRoomId], references: [id], onDelete: Cascade)

  group2StudentClassSubjectTeacherId Int?                        @map("group_2_student_class_subject_teacher_id")
  group2StudentClassSubjectTeacher   StudentClassSubjectTeacher? @relation("TimetableElementsGroup2", fields: [group2StudentClassSubjectTeacherId], references: [id], onDelete: Cascade)

  group2RoomId Int?  @map("group_2_room_id")
  group2Room   Room? @relation("TimetableElementsGroup2", fields: [group2RoomId], references: [id], onDelete: Cascade)

  @@map("timetable_element")
}

enum UserType {
  student
  teacher
  admin
  super_admin

  @@map("user_type_enum")
}

enum Day {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday

  @@map("day_enum")
}
